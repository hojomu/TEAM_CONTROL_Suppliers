<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="control.suppliers.mapper.AdminMapper">

	<!-- 출하 계획표 resultMaps -->
  	<resultMap id="adminOrderResultMap" type="control.suppliers.model.AdminOrderVO">
      <id property="orderId" column="order_id" javaType="int"/>
      <result property="deliveryDate" column="delivery_date"/>
      <collection column="orderId = order_id" property="orderedProduct" javaType="List"
      ofType="control.suppliers.model.OrderedProductVO" select="selectOrderedProductList"/>
    </resultMap>
	<!-- 출하 계획표 불러오기 -->
	<select id="list" resultMap="adminOrderResultMap">
		SELECT
			o.order_id,
			o.delivery_date,
			c.name as customerHospital
		FROM `order` o
		JOIN order_cancel oc ON o.order_id = oc.order_id
		JOIN customer c ON o.customer_id = c.customer_id
		WHERE oc.state = 'normal'
		LIMIT ${(pageNum-1)*amount}, #{amount}
	</select>
	<!-- 주문한 물건 목록 불러오기 (이름, 갯수) -->
	<select id="selectOrderedProductList" parameterType="control.suppliers.model.AdminOrderVO" resultType="control.suppliers.model.OrderedProductVO">
		Select
			op.count AS count,
			p.name AS product
		From ordered_product op
		LEFT JOIN product p ON op.product_id = p.product_id
		WHERE op.order_id = #{orderId}
	</select>
	
	<!-- 계획표 전체 개수 불러오기 ( 검색 키워드를 넣을 시 수정 필수 ) -->
	<select id="total" resultType="int">
  	  select count(*) 
  	  from `order` o
  		left join order_cancel oc ON o.order_id = oc.order_id
  	  where
  	  	oc.oCancel_id = 'normal'
  	</select>
  	
  	
  	
	
	
</mapper>


